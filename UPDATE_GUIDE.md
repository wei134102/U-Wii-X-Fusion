# GitHub Releases 自动更新功能使用指南

## 功能说明

程序已集成基于 GitHub Releases 的自动更新功能，支持：
- ✅ 检查 GitHub Releases 最新版本
- ✅ 自动下载更新包（ZIP）
- ✅ 解压并应用更新
- ✅ 自动重启程序

## 配置说明

### 1. GitHub 仓库信息

更新服务默认配置为：
- **仓库所有者**: `wei134102`
- **仓库名称**: `U-Wii-X-Fusion`

如需修改，请在代码中更改 `UpdateService` 的构造函数参数：
```csharp
var updateService = new UpdateService("你的用户名", "你的仓库名");
```

### 2. 版本号格式

- **程序版本**: 从 `AssemblyInfo.cs` 的 `AssemblyVersion` 读取（当前：1.0.0.0）
- **GitHub Release 标签**: 支持格式 `v1.0.0`、`1.0.0`、`1.0.0.0` 等，会自动解析为 Version 对象比较

### 3. Release 包要求

在 GitHub 创建 Release 时：
1. **标签名**: 使用版本号，如 `v1.0.1` 或 `1.0.1`
2. **发布包**: 上传 ZIP 文件，包含以下内容：
   ```
   U-Wii-X Fusion.exe
   U-Wii-X Fusion.exe.config
   Data/
   CONFIG/  (可选，更新时会保留用户配置)
   ```
3. **发布说明**: 填写更新内容（会在更新窗口显示）

## 使用方式

### 自动检查更新

1. 在**设置**标签页勾选 **"启用自动更新"**
2. 程序启动后 3 秒会自动检查更新
3. 如有新版本，会弹出更新窗口

### 手动检查更新

1. 点击主窗口右上角的 **"检查更新"** 按钮
2. 弹出更新窗口显示当前版本和最新版本
3. 如有新版本，点击 **"下载并更新"**

## 更新流程

1. **检查版本**: 调用 GitHub API 获取最新 Release
2. **下载更新**: 下载 Release 中的第一个资产文件（ZIP）
3. **解压更新**: 解压到临时目录
4. **应用更新**: 
   - 创建更新脚本（.bat）
   - 关闭程序
   - 脚本复制文件到程序目录（保留 CONFIG 和 Data）
   - 重启程序
   - 删除临时文件和脚本

## 注意事项

⚠️ **重要**:
- 更新时会**保留** `CONFIG/` 目录（用户设置）
- 更新时会**保留** `Data/` 目录（游戏数据库）
- 更新需要程序目录有**写入权限**（或管理员权限）
- 如果程序正在运行，更新会在关闭后应用

## 故障排除

### 检查更新失败
- 检查网络连接
- 确认 GitHub 仓库名称正确
- 确认仓库是公开的（或配置了访问权限）

### 下载失败
- 检查 Release 中是否有 ZIP 资产文件
- 检查文件大小是否合理

### 应用更新失败
- 确认程序目录有写入权限
- 关闭可能占用文件的杀毒软件
- 以管理员身份运行程序

## 测试建议

1. **创建测试 Release**:
   - 在 GitHub 创建标签 `v1.0.1`
   - 上传包含新版本 exe 的 ZIP
   - 修改 `AssemblyInfo.cs` 版本为 `1.0.0.0`（低于 Release）
   - 运行程序测试更新流程

2. **验证更新**:
   - 更新后检查版本号是否更新
   - 检查设置是否保留
   - 检查功能是否正常
